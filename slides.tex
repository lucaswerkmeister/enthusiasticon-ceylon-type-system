\documentclass[aspectratio=169]{beamer}
\usepackage[utf8]{inputenc}
\usepackage{hyperref}
\usepackage{listings}
\usepackage{xcolor}

\title{The Ceylon Type System}
\author{Lucas Werkmeister}
\date{EnthusiastiCon 2018}

\lstdefinelanguage{ceylon}{
  morekeywords={
    assembly, module, package, import,
    alias, class, interface, object, given, value, assign, void, function, new,
    of, extends, satisfies, abstracts,
    in, out,
    return, break, continue, throw,
    assert, dynamic,
    if, else, switch, case, for, while, try, catch, finally, then, let,
    this, outer, super,
    is, exists, nonempty
  },
  morekeywords=[2]{
    shared, abstract, formal, default, actual, variable, late, native, deprecated, final, sealed, annotation, suppressWarnings, small, static
  },
  morekeywords=[3]{
    doc, by, license, see, throws, tagged
  },
  sensitive=true,
  morecomment=[l]{//},
  morecomment=[n]{/*}{*/},
  morestring=[b]",
  morestring=[b]',
}

% all colors taken from plugins/org.eclipse.ceylon.ide.eclipse.ui/plugin.xml in the ceylon-ide-eclipse repository
\definecolor{org.eclipse.ceylon.ide.eclipse.ui.theme.color.keywords}{RGB}{76,76,76}
\definecolor{org.eclipse.ceylon.ide.eclipse.ui.theme.color.annotations}{RGB}{51,153,204}
\definecolor{org.eclipse.ceylon.ide.eclipse.ui.theme.color.identifiers}{RGB}{0,51,153}
\definecolor{org.eclipse.ceylon.ide.eclipse.ui.theme.color.types}{RGB}{153,0,102}
\colorlet{org.eclipse.ceylon.ide.eclipse.ui.theme.color.numbers}{blue}
\colorlet{org.eclipse.ceylon.ide.eclipse.ui.theme.color.strings}{blue}
\colorlet{org.eclipse.ceylon.ide.eclipse.ui.theme.color.comments}{darkgray}
% https://tex.stackexchange.com/a/4199/25264
\makeatletter
\newcommand*\ceylonIdeEclipseIdentifier{%
  \expandafter\ceylonIdeEclipseIdentifier@style\the\lst@token\relax%
}
\def\ceylonIdeEclipseIdentifier@style#1#2\relax{%
  \ifcat#1%
    \relax%
  \else%
    \ifnum`#1=\uccode`#1%
      \color{org.eclipse.ceylon.ide.eclipse.ui.theme.color.types}%
    \else%
      \color{org.eclipse.ceylon.ide.eclipse.ui.theme.color.identifiers}%
    \fi%
  \fi%
}
\makeatother
\lstdefinestyle{org.eclipse.ceylon.ide.eclipse.ui.theme}{
  basicstyle=\ttfamily,
  keywordstyle=\bfseries\color{org.eclipse.ceylon.ide.eclipse.ui.theme.color.keywords},
  keywordstyle=[2]\color{org.eclipse.ceylon.ide.eclipse.ui.theme.color.annotations},
  keywordstyle=[3]\color{org.eclipse.ceylon.ide.eclipse.ui.theme.color.annotations},
  identifierstyle=\ceylonIdeEclipseIdentifier,
  numberstyle=\color{org.eclipse.ceylon.ide.eclipse.ui.theme.color.numbers},
  stringstyle=\color{org.eclipse.ceylon.ide.eclipse.ui.theme.color.strings},
  commentstyle=\color{org.eclipse.ceylon.ide.eclipse.ui.theme.color.comments},
}

% all colors taken from typechecker/en/styles/ceylon.css in the ceylon repository
\definecolor{ceylon.rainbow.comment}{HTML}{008b8b} % darkcyan
\colorlet{ceylon.rainbow.constant.numeric}{blue}
\colorlet{ceylon.rainbow.constant.string}{blue}
\definecolor{ceylon.rainbow.entity.function}{RGB}{51,153,204}
\definecolor{ceylon.rainbow.entity.class}{RGB}{153,0,102}
\definecolor{ceylon.rainbow.variable.global}{RGB}{0,51,153}
\definecolor{ceylon.rainbow.keyword}{RGB}{76,76,76}
% https://tex.stackexchange.com/a/4199/25264
\makeatletter
\newcommand*\ceylonRainbowIdentifier{%
  \expandafter\ceylonRainbowIdentifier@style\the\lst@token\relax%
}
\def\ceylonRainbowIdentifier@style#1#2\relax{%
  \ifcat#1%
    \relax%
  \else%
    \ifnum`#1=\uccode`#1%
      \color{ceylon.rainbow.entity.class}%
    \else%
      \color{ceylon.rainbow.variable.global}%
    \fi%
  \fi%
}
\makeatother
\lstdefinestyle{ceylon.rainbow}{ % mostly identical to org.eclipse.ceylon.ide.eclipse.ui.theme – see also https://github.com/eclipse/ceylon/issues/7343
  basicstyle=\ttfamily,
  keywordstyle=\bfseries\color{ceylon.rainbow.keyword},
  keywordstyle=[2]\color{ceylon.rainbow.entity.function},
  keywordstyle=[3]\color{ceylon.rainbow.entity.function},
  identifierstyle=\ceylonRainbowIdentifier,
  numberstyle=\color{ceylon.rainbow.constant.numeric},
  stringstyle=\color{ceylon.rainbow.constant.string},
  commentstyle=\color{ceylon.rainbow.comment},
}

\lstset{language=ceylon}
%\lstset{style=org.eclipse.ceylon.ide.eclipse.ui.theme}
\lstset{style=ceylon.rainbow}

\begin{document}

\frame{\titlepage}

\begin{frame}
  \frametitle{Ceylon}
  \begin{itemize}
  \item strongly+statically typed programming language
  \item compiles to JVM~bytecode, JavaScript, Dart~(WIP) or LLVM (\emph{very}~WIP)
  \item support functional programming too
  \item modularity
  \item readability
  \item please see \url{https://ceylon-lang.org} for more marketing
  \end{itemize}
\end{frame}

% TODO is this worth the time it takes up?
\begin{frame}
  \frametitle{Type systems}
  Adding type information to your code helps…
  \begin{itemize}
  \item …people reading the code to understand it
  \item …the compiler to spot bugs
  \item …the IDE to make useful suggestions when writing new code
  \item …the IDE to do the correct thing when refactoring existing code
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Union and intersection types}
  A value of type \lstinline{X|Y} can have the type \lstinline{X} or \lstinline{Y}.
  \pause
  \begin{lstlisting}
shared Document|ParseError parseDocument(String html);
  \end{lstlisting}
  \pause
  \begin{lstlisting}
shared void enqueue(Element item, Integer? priority = null);
  \end{lstlisting}
  \pause
  \lstinline{Integer?} is equivalent to \lstinline{Integer|Null}.
  (\lstinline{Null} is a class with only one instance, \lstinline{null}.)
\end{frame}

\begin{frame}[fragile]
  \frametitle{Union and intersection types}
  A value of type \lstinline{X&Y} has the types \lstinline{X} and \lstinline{Y}.
  \pause
  \begin{lstlisting}
shared Iterable<Element&Object> coalesced;
  \end{lstlisting}
  \pause
  \begin{lstlisting}
shared void printScaled(
    Printable&Scalable element, Float factor);
  \end{lstlisting}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Flow-sensitive typing}
  Instead of Java’s
  \begin{lstlisting}[language=java]
Object o = ...;
if (o instanceof String) {
  String s = (String)o;
  String su = s.toUpperCase();
}
  \end{lstlisting}
  \pause
  you simply write
  \begin{lstlisting}
Object o = ...;
if (is String o) {
  // o has type String now
  String su = o.uppercased; // look ma, no cast!
}
  \end{lstlisting}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Flow-sensitive typing}
  \begin{onlyenv}<1>
    \begin{lstlisting}
String? arg = process.arguments.first;
if (exists arg) {
  // arg: String





  print(arg.uppercased);
}
    \end{lstlisting}
  \end{onlyenv}
  \begin{onlyenv}<2>
    \begin{lstlisting}
String? arg = process.arguments.first;
if (exists arg) { // is Object arg
  // arg: <String?>&Object





  print(arg.uppercased);
}
    \end{lstlisting}
  \end{onlyenv}
  \begin{onlyenv}<3>
    \begin{lstlisting}
String? arg = process.arguments.first;
if (exists arg) { // is Object arg
  // arg: <String?>&Object
  //    = <String|Null>&Object




  print(arg.uppercased);
}
    \end{lstlisting}
  \end{onlyenv}
  \begin{onlyenv}<4>
    \begin{lstlisting}
String? arg = process.arguments.first;
if (exists arg) { // is Object arg
  // arg: <String?>&Object
  //    = <String|Null>&Object
  //    = <String&Object>|<Null&Object>



  print(arg.uppercased);
}
    \end{lstlisting}
  \end{onlyenv}
  \begin{onlyenv}<5>
    \begin{lstlisting}
String? arg = process.arguments.first;
if (exists arg) { // is Object arg
  // arg: <String?>&Object
  //    = <String|Null>&Object
  //    = <String&Object>|<Null&Object>
  //    = String|<Null&Object>


  print(arg.uppercased);
}
    \end{lstlisting}
  \end{onlyenv}
  \begin{onlyenv}<6>
    \begin{lstlisting}
String? arg = process.arguments.first;
if (exists arg) { // is Object arg
  // arg: <String?>&Object
  //    = <String|Null>&Object
  //    = <String&Object>|<Null&Object>
  //    = String|<Null&Object>
  //    = String|Nothing

  print(arg.uppercased);
}
    \end{lstlisting}
  \end{onlyenv}
  \begin{onlyenv}<7>
    \begin{lstlisting}
String? arg = process.arguments.first;
if (exists arg) { // is Object arg
  // arg: <String?>&Object
  //    = <String|Null>&Object
  //    = <String&Object>|<Null&Object>
  //    = String|<Null&Object>
  //    = String|Nothing
  //    = String
  print(arg.uppercased);
}
    \end{lstlisting}
  \end{onlyenv}
\end{frame}

\end{document}
